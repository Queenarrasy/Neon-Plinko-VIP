<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON MASTER CONTROL - V2 PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { --pink: #ff0077; --blue: #00d4ff; --yellow: #fbff00; --bg: #05060f; --green: #00ff88; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; margin: 0; }
        
        /* HEADER & STATS */
        .header { text-align: center; padding: 20px; border: 2px solid var(--blue); box-shadow: 0 0 15px var(--blue); border-radius: 15px; background: rgba(0, 212, 255, 0.05); margin-bottom: 20px; }
        .header h2 { margin: 0; color: var(--pink); text-shadow: 0 0 15px var(--pink); text-transform: uppercase; letter-spacing: 2px; }
        
        .admin-tools { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-tool { background: transparent; border: 1px solid white; color: white; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .btn-sync { border-color: var(--blue); color: var(--blue); box-shadow: 0 0 5px var(--blue); }
        .btn-broadcast { border-color: var(--yellow); color: var(--yellow); box-shadow: 0 0 5px var(--yellow); }

        /* USER LIST */
        .user-box { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(0, 212, 255, 0.2); padding: 15px; margin-top: 10px; border-radius: 12px; display: flex; flex-direction: column; gap: 10px; position: relative; }
        .user-info { display: flex; justify-content: space-between; align-items: flex-start; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .online { background: var(--green); box-shadow: 0 0 8px var(--green); }
        .offline { background: #555; }
        
        .username { color: var(--blue); font-size: 16px; font-weight: bold; text-shadow: 0 0 5px var(--blue); }
        .details { font-size: 12px; color: #aaa; margin-top: 4px; }
        .balance-text { color: var(--yellow); font-weight: bold; font-size: 14px; }

        /* CONTROLS */
        .controls { display: flex; gap: 8px; margin-top: 5px; }
        select, .btn-action { background: #000; color: white; border: 1px solid #444; padding: 8px; border-radius: 6px; font-size: 11px; cursor: pointer; }
        .btn-inject { border-color: var(--green); color: var(--green); }
        .btn-winrate { border-color: var(--pink); color: var(--pink); }

        /* MODAL & TOAST */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 999; backdrop-filter: blur(5px); }
        #modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #0a0b1a; border: 2px solid var(--yellow); padding: 25px; z-index: 1000; border-radius: 15px; width: 80%; max-width: 300px; text-align: center; }
        #toast { visibility: hidden; min-width: 200px; background: var(--blue); color: #000; text-align: center; border-radius: 8px; padding: 12px; position: fixed; z-index: 1100; bottom: 30px; left: 50%; transform: translateX(-50%); font-weight: bold; }
        #toast.show { visibility: visible; animation: fade 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fade { from {opacity: 0;} to {opacity: 1;} }
    </style>
</head>
<body id="main-content" style="display:none;">

    <audio id="snd-click" src="https://www.soundjay.com/buttons/sounds/button-16.mp3"></audio>
    <audio id="snd-success" src="https://www.soundjay.com/buttons/sounds/button-09.mp3"></audio>

    <div class="header">
        <h2>MASTER PANEL V2</h2>
        <p style="font-size:10px; color:var(--yellow); margin:5px 0 0;">ENCRYPTED TERMINAL: <span id="clock">00:00:00</span></p>
    </div>

    <div class="admin-tools">
        <button class="btn-tool btn-sync" onclick="fetchData()"><i class="fa-solid fa-sync"></i> Sync Data</button>
        <button class="btn-tool btn-broadcast" onclick="globalBroadcast()"><i class="fa-solid fa-bullhorn"></i> Broadcast</button>
    </div>

    <div id="display-area"></div>

    <div id="toast">ACTION SUCCESS</div>
    <div class="overlay" id="overlay"></div>
    <div id="modal">
        <h3 id="modal-title" style="color:var(--yellow); margin-top:0;">OVERRIDE</h3>
        <p id="modal-msg" style="font-size:13px;"></p>
        <button onclick="executeAction()" style="background:var(--pink); border:none; color:white; padding:10px 20px; border-radius:5px; cursor:pointer; font-weight:bold;">CONFIRM</button>
        <button onclick="closeModal()" style="background:#333; border:none; color:white; padding:10px 20px; border-radius:5px; cursor:pointer; margin-left:10px;">EXIT</button>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzYTC11njbEBtAsdpbaRLJRt13j7iEKCkANV1SgxxguV_zFUyZ6Z7FAj0SKuw4d5ThmKw/exec";
        const ADMIN_PIN = "2026"; // GANTI PIN SESUAI KEINGINAN ANDA
        let currentTarget = "";
        let currentVal = "";
        let currentAction = "";

        // 1. SECURITY PIN ACCESS
        window.onload = () => {
            const pass = prompt("ENTER MASTER PIN:");
            if (pass === ADMIN_PIN) {
                document.getElementById('main-content').style.display = 'block';
                fetchData();
            } else {
                alert("ACCESS DENIED");
                document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:100px;'>UNAUTHORIZED ACCESS</h1>";
            }
        };

        function playSnd(id) { document.getElementById(id).play().catch(e=>{}); }
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);

        // 2. FETCH DATA & DISPLAY
        async function fetchData() {
            const area = document.getElementById('display-area');
            area.innerHTML = "<p style='text-align:center; color:var(--blue)'>SYNCING DATABASE...</p>";
            try {
                const response = await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: "getAllUsers" }) });
                const users = await response.json();
                area.innerHTML = "";
                users.forEach(u => {
                    const statusClass = u.status === "ONLINE" ? "online" : "offline";
                    const div = document.createElement('div');
                    div.className = 'user-box';
                    div.innerHTML = `
                        <div class="user-info">
                            <div>
                                <span class="status-dot ${statusClass}"></span>
                                <span class="username">${u.username.toUpperCase()}</span>
                                <div class="details">${u.fullname} | ${u.winrate} WR</div>
                            </div>
                            <div class="balance-text">IDR ${u.saldo.toLocaleString()}</div>
                        </div>
                        <div class="controls">
                            <button class="btn-action btn-inject" onclick="openInject('${u.username}')"><i class="fa-solid fa-coins"></i> Â± CREDIT</button>
                            <select class="btn-winrate" onchange="openWinrate('${u.username}', this.value)">
                                <option value="">SET RATE</option>
                                <option value="100">100% JP</option>
                                <option value="80">80% GACOR</option>
                                <option value="50">NORMAL</option>
                                <option value="5">ZONK</option>
                            </select>
                        </div>
                    `;
                    area.appendChild(div);
                });
            } catch (e) { area.innerHTML = "<p style='text-align:center; color:var(--pink)'>OFFLINE: CHECK API URL</p>"; }
        }

        // 3. ACTION HANDLERS
        function openInject(user) {
            const amt = prompt("Masukkan jumlah (Gunakan minus '-' untuk potong, misal: -5000):", "10000");
            if (!amt || isNaN(amt)) return;
            currentTarget = user;
            currentVal = amt;
            currentAction = "adminUpdateSaldo";
            showModal("INJECT CREDIT", `Tambah/Kurang saldo <b>${user}</b> sebesar <b>${amt}</b>?`);
        }

        function openWinrate(user, rate) {
            if (!rate) return;
            currentTarget = user;
            currentVal = rate;
            currentAction = "updateWinrate";
            showModal("OVERRIDE WINRATE", `Ubah rate <b>${user}</b> menjadi <b>${rate}%</b>?`);
        }

        function globalBroadcast() {
            const msg = prompt("Masukkan pesan untuk SEMUA user:");
            const gift = prompt("Jumlah saldo hadiah (0 jika tidak ada):", "0");
            if (!msg) return;
            alert("Fitur sedang dikembangkan. Pesan akan dicatat di log.");
        }

        // 4. EXECUTION
        async function executeAction() {
            closeModal();
            playSnd('snd-click');
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        action: currentAction, 
                        targetUser: currentTarget, 
                        amount: currentVal, // Untuk Saldo
                        newRate: currentVal // Untuk Winrate
                    })
                });
                const result = await res.json();
                if (result.result === "SUCCESS") {
                    playSnd('snd-success');
                    showToast("SYSTEM UPDATED!");
                    fetchData();
                }
            } catch (e) { showToast("ERROR!"); }
        }

        // UI HELPERS
        function showModal(title, msg) {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-msg').innerHTML = msg;
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }
        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }
        function showToast(txt) {
            const t = document.getElementById('toast');
            t.innerText = txt; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
