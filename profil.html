<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROFIL VIP - NEON PLINKO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { 
            --pink: #ff0077; --blue: #00d4ff; --yellow: #fbff00; --bg: #070816; 
            --neon-pink: 0 0 10px var(--pink);
            --neon-blue: 0 0 10px var(--blue);
            --neon-yellow: 0 0 10px var(--yellow);
        }
        
        body { 
            background: var(--bg); color: white; 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container { width: 100%; max-width: 400px; }

        .btn-back {
            display: inline-block; margin-bottom: 20px; color: var(--blue);
            text-decoration: none; font-weight: bold; font-size: 13px; text-transform: uppercase;
        }

        .user-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .user-header i { font-size: 50px; color: var(--pink); text-shadow: var(--neon-pink); }
        .user-header h3 { margin: 0; color: var(--blue); text-shadow: var(--neon-blue); text-transform: uppercase; }
        .user-header p { margin: 0; font-size: 12px; color: var(--yellow); text-shadow: var(--neon-yellow); font-weight: bold; }

        .saldo-card {
            background: linear-gradient(135deg, #0d0f26, #1a1d40);
            border: 2px solid var(--blue); border-radius: 20px;
            padding: 25px 20px; text-align: center; box-shadow: var(--neon-blue); margin-bottom: 25px;
        }
        .saldo-card p { margin: 0; font-size: 11px; font-weight: 900; color: var(--yellow); letter-spacing: 2px; }
        .saldo-card h2 { margin: 10px 0 0 0; font-size: 32px; color: white; text-shadow: 0 0 15px var(--blue); font-weight: 900; }

        .menu-container { display: flex; flex-direction: column; gap: 10px; }
        .info-row {
            background: rgba(255, 255, 255, 0.03); padding: 15px;
            border-radius: 12px; display: flex; justify-content: space-between;
            align-items: center; border: 1px solid #222;
        }
        .info-row span:first-child { color: #888; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .info-row span:last-child { color: var(--blue); font-size: 13px; font-weight: bold; text-align: right; }

        .btn-action {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            padding: 16px; border-radius: 50px; text-decoration: none;
            font-weight: 900; font-size: 14px; text-transform: uppercase;
            border: none; margin-top: 10px; cursor: pointer;
        }
        .btn-game { background: rgba(0, 212, 255, 0.1); color: var(--blue); border: 1px solid var(--blue); box-shadow: var(--neon-blue); margin-top: 20px; }
        .btn-logout { background: rgba(255, 0, 119, 0.1); color: var(--pink); border: 1px solid var(--pink); box-shadow: var(--neon-pink); }

        /* Modal Style */
        #neon-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); 
            display: none; justify-content: center; align-items: center; z-index: 9999; 
        }
        .neon-modal { 
            background: #0d0f26; border: 2px solid var(--pink); border-radius: 20px; 
            padding: 25px; width: 80%; max-width: 300px; text-align: center; box-shadow: 0 0 30px var(--pink); 
        }
        .modal-btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .modal-btn { padding: 12px; flex: 1; border: none; border-radius: 10px; font-weight: 900; cursor: pointer; text-transform: uppercase; }
        .btn-cancel { background: #333; color: white; }
        .btn-confirm { background: var(--pink); color: white; box-shadow: var(--neon-pink); }
    </style>
</head>
<body>

    <div id="neon-overlay">
        <div class="neon-modal">
            <h2 style="color:var(--pink); text-shadow:var(--neon-pink);">LOGOUT</h2>
            <p style="color:white;">Yakin ingin keluar akun VIP?</p>
            <div class="modal-btn-group">
                <button class="modal-btn btn-cancel" onclick="closeModal()">BATAL</button>
                <button class="modal-btn btn-confirm" onclick="confirmLogout()">KELUAR</button>
            </div>
        </div>
    </div>

    <div class="container">
        <a href="game.html" class="btn-back"><i class="fa-solid fa-chevron-left"></i> Kembali</a>

        <div class="user-header">
            <i class="fa-solid fa-circle-user"></i>
            <div>
                <h3 id="profile-username">---</h3>
                <p id="profile-tier">MEMUAT...</p>
            </div>
        </div>

        <div class="saldo-card">
            <p>SALDO UTAMA</p>
            <h2 id="display-saldo">IDR 0</h2>
        </div>

        <div class="menu-container">
            <div class="info-row"><span>NAMA LENGKAP</span><span id="profile-fullname">MEMUAT...</span></div>
            <div class="info-row"><span>BANK / E-WALLET</span><span id="profile-bank">MEMUAT...</span></div>
            <div class="info-row"><span>NOMOR REKENING</span><span id="profile-rek">MEMUAT...</span></div>

            <a href="game.html" class="btn-action btn-game"><i class="fa-solid fa-gamepad"></i> LANJUT BERMAIN</a>
            <button class="btn-action btn-logout" onclick="showLogoutModal()"><i class="fa-solid fa-right-from-bracket"></i> LOGOUT</button>
        </div>
    </div>

    <script>
        // GANTI URL INI DENGAN URL DEPLOYMENT GOOGLE APPS SCRIPT TERBARU KAMU
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzYTC11njbEBtAsdpbaRLJRt13j7iEKCkANV1SgxxguV_zFUyZ6Z7FAj0SKuw4d5ThmKw/exec";

        function showLogoutModal() { document.getElementById('neon-overlay').style.display = 'flex'; }
        function closeModal() { document.getElementById('neon-overlay').style.display = 'none'; }
        function confirmLogout() { localStorage.clear(); window.location.href = 'index.html'; }

        async function syncProfile() {
            const user = localStorage.getItem('user_session');
            
            // 1. Cek Sesi (Jika tidak ada, lempar ke login)
            if (!user) { 
                window.location.href = 'index.html'; 
                return; 
            }

            // 2. Tampilkan Username Lokal (Cepat)
            document.getElementById('profile-username').innerText = user.toUpperCase();
            
            try {
                // 3. Tarik Data dari Google Sheets
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        action: 'getUserData', 
                        username: user 
                    })
                });

                const data = await response.json();
                console.log("Respon Server:", data); 

                if (data && data.result === "SUCCESS") {
                    // Update UI dengan data asli dari database
                    document.getElementById('display-saldo').innerText = "IDR " + Number(data.saldo || 0).toLocaleString('id-ID');
                    document.getElementById('profile-tier').innerText = (data.tier || "BRONZE").toUpperCase() + " MEMBER";
                    document.getElementById('profile-fullname').innerText = (data.fullname || "DATA TIDAK ADA").toUpperCase();
                    document.getElementById('profile-bank').innerText = (data.bank || "-").toUpperCase();
                    document.getElementById('profile-rek').innerText = data.rekening || "-";

                    // Update Saldo lokal agar sinkron dengan game
                    localStorage.setItem('saldo', data.saldo);
                } else {
                    document.getElementById('profile-tier').innerText = "USER TIDAK DITEMUKAN";
                }

            } catch (err) {
                console.error("Koneksi Gagal:", err);
                // Jika offline/gagal koneksi, gunakan data yang tersimpan di HP (Cache)
                const localSaldo = localStorage.getItem('saldo') || 0;
                document.getElementById('display-saldo').innerText = "IDR " + Number(localSaldo).toLocaleString('id-ID');
                document.getElementById('profile-tier').innerText = "OFFLINE MODE";
                
                // Ubah status memuat menjadi pesan error
                document.getElementById('profile-fullname').innerText = "KONEKSI BERMASALAH";
                document.getElementById('profile-bank').innerText = "KONEKSI BERMASALAH";
                document.getElementById('profile-rek').innerText = "KONEKSI BERMASALAH";
            }
        }

        // Jalankan sinkronisasi saat halaman dimuat
        window.onload = syncProfile;
    </script>
</body>
</html>
