<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>REWARD REFERRAL - NEON PLINKO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { --pink: #ff0077; --blue: #00d4ff; --yellow: #fbff00; --bg: #070816; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 20px; }
        .btn-back { color: var(--blue); text-decoration: none; font-weight: 900; font-size: 12px; display: flex; align-items: center; gap: 5px; margin-bottom: 20px; text-transform: uppercase; }
        .reward-header { background: linear-gradient(145deg, rgba(255,0,119,0.1), rgba(0,212,255,0.1)); border: 1px solid var(--blue); border-radius: 20px; padding: 20px; text-align: center; margin-bottom: 25px; box-shadow: 0 0 20px rgba(0,212,255,0.2); }
        .reward-header h2 { color: var(--yellow); margin: 0; font-size: 18px; text-transform: uppercase; }
        .referral-code-container { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--blue); border-radius: 15px; padding: 15px; text-align: center; margin-bottom: 20px; }
        .code-box { background: #000; border: 1px dashed var(--blue); color: var(--yellow); padding: 10px; font-size: 20px; font-family: monospace; font-weight: 900; letter-spacing: 3px; margin: 10px 0; border-radius: 8px; cursor: pointer; }
        .daily-reward-card { background: rgba(255, 255, 255, 0.05); border: 2px dashed var(--yellow); border-radius: 15px; padding: 15px; text-align: center; margin-bottom: 20px; }
        .btn-daily { background: var(--yellow); color: black; border: none; padding: 10px 20px; border-radius: 10px; font-weight: 900; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-daily:disabled { background: #333; color: #666; cursor: not-allowed; }
        .admin-inbox { margin-bottom: 25px; border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 15px; padding: 15px; background: rgba(0, 0, 0, 0.6); }
        .inbox-title { font-size: 13px; color: var(--blue); font-weight: 900; margin-bottom: 12px; text-transform: uppercase; }
        .msg-card { background: rgba(255, 255, 255, 0.03); border: 1px solid #222; padding: 12px; border-radius: 10px; margin-bottom: 10px; }
        .btn-claim-gift { background: var(--blue); color: white; border: none; padding: 7px 15px; border-radius: 6px; font-size: 11px; font-weight: 900; cursor: pointer; width: 100%; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: rgba(0,0,0,0.4); border: 1px solid #333; padding: 15px; border-radius: 15px; text-align: center; }
        .referral-item { background: rgba(255,255,255,0.03); border: 1px solid #222; padding: 12px 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .status-badge { font-size: 8px; font-weight: 900; padding: 4px 8px; border-radius: 4px; }
        .valid { color: #00ff88; border: 1px solid #00ff88; }
        .invalid { color: var(--pink); border: 1px solid var(--pink); }
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div style="width:40px; height:40px; border:4px solid var(--blue); border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite;"></div>
    </div>

    <a href="game.html" class="btn-back"><i class="fa-solid fa-arrow-left"></i> KEMBALI KE GAME</a>

    <div class="referral-code-container">
        <small style="color: var(--blue); font-weight: 900;">KODE REFERRAL ANDA</small>
        <div class="code-box" id="my-referral-code" onclick="copyCode()">MEMUAT...</div>
    </div>

    <div class="daily-reward-card">
        <small style="color: var(--yellow); font-weight: 900;">DAILY CHECK-IN</small>
        <div style="font-size: 18px; font-weight: 900; margin: 5px 0;">IDR 1.000</div>
        <button id="btn-daily" class="btn-daily" onclick="claimDaily()">KLAIM HADIAH HARIAN</button>
    </div>

    <div class="admin-inbox">
        <div class="inbox-title"><i class="fa-solid fa-envelope"></i> KOTAK MASUK</div>
        <div id="inbox-list">
            <div style="font-size:11px; color:#555; text-align:center;">Mengecek kotak masuk...</div>
        </div>
    </div>

    <div class="stat-grid">
        <div class="stat-card">
            <small>Total Undangan</small>
            <div id="total-invite">0</div>
        </div>
        <div class="stat-card">
            <small>Reward Tersedia</small>
            <div id="total-reward" style="color: var(--yellow);">IDR 0</div>
        </div>
    </div>

    <div class="history-section">
        <h3 style="font-size:13px; color:var(--blue);"><i class="fa-solid fa-users"></i> RIWAYAT UNDANGAN</h3>
        <div id="referral-list"></div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzYTC11njbEBtAsdpbaRLJRt13j7iEKCkANV1SgxxguV_zFUyZ6Z7FAj0SKuw4d5ThmKw/exec";
        const USERNAME = localStorage.getItem('user_session');

        async function initPage() {
            if (!USERNAME) { window.location.href = 'index.html'; return; }
            document.getElementById('loading-overlay').style.display = 'flex';
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: "getRewardData", username: USERNAME })
                });
                const data = await response.json();

                // Set Kode Referral
                document.getElementById('my-referral-code').innerText = data.referralCode || "USER" + Math.floor(Math.random()*1000);

                // Inbox
                const inboxList = document.getElementById('inbox-list');
                if (data.messages.length > 0) {
                    inboxList.innerHTML = data.messages.map(m => `
                        <div class="msg-card">
                            <div style="font-size:11px; margin-bottom:8px;">${m.pesan}</div>
                            <button class="btn-claim-gift" onclick="claimInbox('${m.id}', ${m.hadiah})">AMBIL IDR ${m.hadiah.toLocaleString()}</button>
                        </div>
                    `).join('');
                } else {
                    inboxList.innerHTML = `<div style="font-size:11px; color:#555; text-align:center;">Belum ada pesan masuk.</div>`;
                }

                // Referral Stats
                document.getElementById('total-invite').innerText = data.invitedList.length;
                document.getElementById('total-reward').innerText = "IDR " + (data.totalValid * 5000).toLocaleString();

                // Referral List
                const refList = document.getElementById('referral-list');
                if (data.invitedList.length > 0) {
                    refList.innerHTML = data.invitedList.map(u => `
                        <div class="referral-item">
                            <div style="font-size:13px;"><b>${u.username}</b></div>
                            <span class="status-badge ${u.status === 'VALID' ? 'valid' : 'invalid'}">${u.status}</span>
                        </div>
                    `).join('');
                } else {
                    refList.innerHTML = `<div style="text-align:center; color:#444; font-size:12px; padding:20px;">Belum ada teman yang diundang.</div>`;
                }

                checkDailyStatus();
            } catch (e) {
                console.error(e);
            }
            document.getElementById('loading-overlay').style.display = 'none';
        }

        async function claimDaily() {
            document.getElementById('loading-overlay').style.display = 'flex';
            const resp = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "dailyCheckin", username: USERNAME })
            });
            const res = await resp.json();
            if(res.result === "SUCCESS") {
                localStorage.setItem('last_claim_' + USERNAME, new Date().toDateString());
                alert("Berhasil! IDR 1.000 masuk ke saldo utama.");
                location.reload();
            }
        }

        function checkDailyStatus() {
            const last = localStorage.getItem('last_claim_' + USERNAME);
            if (last === new Date().toDateString()) {
                const btn = document.getElementById('btn-daily');
                btn.disabled = true;
                btn.innerText = "SUDAH DIKLAIM HARI INI";
            }
        }

        async function claimInbox(id, amount) {
            document.getElementById('loading-overlay').style.display = 'flex';
            const resp = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "claimInbox", id: id, username: USERNAME, amount: amount })
            });
            const res = await resp.json();
            if(res.result === "SUCCESS") {
                alert("Saldo hadiah berhasil diklaim!");
                location.reload();
            }
        }

        function copyCode() {
            const code = document.getElementById('my-referral-code').innerText;
            navigator.clipboard.writeText(code);
            alert("Kode disalin: " + code);
        }

        window.onload = initPage;
    </script>
    <style> @keyframes spin { to { transform: rotate(360deg); } } </style>
</body>
</html>
