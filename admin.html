<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN CONTROL CENTER</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { background: #070816; color: white; font-family: sans-serif; margin: 0; padding: 20px; }
        .neon-title { color: #ff0077; text-shadow: 0 0 10px #ff0077; text-align: center; }
        .user-card { 
            background: rgba(255,255,255,0.05); 
            border: 1px solid #00d4ff; 
            border-radius: 15px; 
            padding: 15px; 
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .info h4 { margin: 0; color: #fbff00; }
        .info p { margin: 5px 0; font-size: 12px; color: #ccc; }
        .control { text-align: right; }
        select { 
            background: #000; color: #00d4ff; border: 1px solid #00d4ff; 
            padding: 5px; border-radius: 5px; font-weight: bold;
        }
        .btn-refresh { 
            width: 100%; padding: 10px; background: #00d4ff; border: none; 
            border-radius: 10px; font-weight: bold; margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <h2 class="neon-title"><i class="fa-solid fa-user-shield"></i> PENGENDALI WINRATE</h2>
    <button class="btn-refresh" onclick="loadUsers()">REFRESH DATA PEMAIN</button>

    <div id="user-list">
        <p style="text-align:center;">Memuat data...</p>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzYTC11njbEBtAsdpbaRLJRt13j7iEKCkANV1SgxxguV_zFUyZ6Z7FAj0SKuw4d5ThmKw exec"; // GANTI DENGAN URL WEB APP KAMU

        async function loadUsers() {
            const listDiv = document.getElementById('user-list');
            listDiv.innerHTML = '<p style="text-align:center;">Menghubungkan ke Server...</p>';
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: "getAllUsers" })
                });
                const users = await response.json();
                
                listDiv.innerHTML = '';
                users.forEach(user => {
                    const card = document.createElement('div');
                    card.className = 'user-card';
                    card.innerHTML = `
                        <div class="info">
                            <h4>${user.username}</h4>
                            <p>Saldo: IDR ${user.saldo.toLocaleString()}</p>
                            <p>Winrate Saat Ini: <b style="color:#ff0077">${user.winrate}</b></p>
                        </div>
                        <div class="control">
                            <label style="font-size:10px; display:block;">SET WINRATE</label>
                            <select onchange="updateRate('${user.username}', this.value)">
                                <option value="">Pilih</option>
                                <option value="100">100% (JP)</option>
                                <option value="80">80% (Gacor)</option>
                                <option value="50">50% (Normal)</option>
                                <option value="20">20% (Kuras)</option>
                                <option value="5">5% (Zonk)</option>
                            </select>
                        </div>
                    `;
                    listDiv.appendChild(card);
                });
            } catch (e) {
                listDiv.innerHTML = '<p style="text-align:center; color:red;">Gagal memuat data!</p>';
            }
        }

        async function updateRate(username, rate) {
            if(!rate) return;
            if(!confirm(`Ubah winrate ${username} menjadi ${rate}%?`)) return;

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        action: "updateWinrate", 
                        targetUser: username, 
                        newRate: rate 
                    })
                });
                alert("Berhasil diperbarui!");
                loadUsers();
            } catch (e) {
                alert("Gagal update!");
            }
        }

        // Load awal
        window.onload = loadUsers;
    </script>
</body>
</html>
