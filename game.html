<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON PLINKO VIP - ULTIMATE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --pink: #ff0077; --blue: #0044ff; --yellow: #fbff00; --white: #ffffff; --bg: #03040a;
            --neon-pink: 0 0 15px var(--pink), 0 0 30px var(--pink);
            --neon-white: 0 0 10px var(--white);
            --neon-yellow: 0 0 15px var(--yellow);
        }
        body {
            background: var(--bg); color: white; font-family: sans-serif;
            margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column;
        }
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; background: rgba(0, 0, 0, 0.9); border-bottom: 2px solid var(--blue);
        }
        .balance-box {
            background: #000; border: 2px solid var(--pink); border-radius: 50px;
            padding: 8px 20px; box-shadow: var(--neon-pink);
        }
        #display-saldo { font-size: 18px; font-weight: bold; text-shadow: 0 0 5px white; }
        
        #game-board { position: relative; width: 100%; height: 380px; overflow: visible; }
        .peg {
            position: absolute; width: 6px; height: 6px; background: var(--white);
            border-radius: 50%; box-shadow: var(--neon-white); transform: translate(-50%, -50%);
        }
        .peg.hit { background: var(--yellow); box-shadow: var(--neon-yellow); transform: translate(-50%, -50%) scale(1.8); }
        .ball {
            position: absolute; width: 14px; height: 14px; background: var(--pink);
            border-radius: 50%; box-shadow: var(--neon-pink); transform: translate(-50%, -50%); z-index: 10;
        }
        
        .multiplier-row { display: flex; justify-content: center; gap: 4px; padding: 0 10px; margin: 10px 0; }
        .slot {
            flex: 1; height: 35px; display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: 900; border-radius: 5px; color: #000; transition: 0.2s;
        }
        .slot.active { transform: translateY(-10px) scale(1.1); box-shadow: 0 0 20px white; filter: brightness(1.5); }
        .s-high { background: var(--pink); } .s-mid { background: var(--yellow); } .s-low { background: var(--blue); color: white !important; }

        #floating-score {
            position: fixed; top: 80px; right: 20px; background: rgba(0,0,0,0.8);
            border: 2px solid var(--yellow); border-radius: 10px; padding: 10px;
            display: none; z-index: 1000; box-shadow: var(--neon-yellow);
        }

        .controls { padding: 15px; background: #050714; border-top: 2px solid var(--blue); }
        .mode-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .btn-mode {
            background: #000; border: 1px solid var(--pink); color: white; padding: 8px 12px;
            border-radius: 8px; font-size: 10px; cursor: pointer;
        }
        .btn-mode.active { background: var(--pink); box-shadow: var(--neon-pink); }
        .btn-play {
            width: 100%; padding: 15px; border-radius: 50px; background: linear-gradient(90deg, #aa0055, #0022aa);
            color: white; font-weight: 900; border: 2px solid var(--yellow);
        }
        
        .nav-bottom { display: grid; grid-template-columns: repeat(4, 1fr); background: #000; padding: 10px 0; }
        .nav-item { color: white; font-size: 9px; text-align: center; text-decoration: none; opacity: 0.7; }
        .nav-item i { font-size: 18px; display: block; margin-bottom: 2px; }
    </style>
</head>
<body>

    <div id="floating-score">
        <div style="font-size: 8px;">LAST WIN</div>
        <div id="score-val" style="color: var(--yellow); font-weight: bold;">0</div>
    </div>

    <div class="header">
        <div onclick="location.href='profil.html'"><i class="fa-solid fa-user-circle" style="color: var(--pink); font-size: 24px;"></i></div>
        <div class="balance-box"><div id="display-saldo">IDR 0</div></div>
        <div onclick="location.href='settings.html'"><i class="fa-solid fa-gear" style="color: var(--yellow); font-size: 22px;"></i></div>
    </div>

    <div id="game-board"></div>
    <div class="multiplier-row" id="slot-row"></div>

    <div class="controls">
        <div class="mode-row">
            <button class="btn-mode active" id="m-normal" onclick="setSpeed('normal')">NORMAL</button>
            <button class="btn-mode" id="m-turbo" onclick="setSpeed('turbo')">TURBO</button>
            <button class="btn-mode" id="m-auto" onclick="toggleAuto()">AUTO: OFF</button>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <i class="fa-solid fa-minus" onclick="changeBet(-1)" style="color:var(--pink)"></i>
            <span id="current-bet" style="color:var(--yellow); font-size:20px; font-weight:bold;">400</span>
            <i class="fa-solid fa-plus" onclick="changeBet(1)" style="color:var(--blue)"></i>
        </div>
        <button class="btn-play" onclick="handlePlay()">PLAY BALL</button>
    </div>

    <div class="nav-bottom">
        <a href="deposit.html" class="nav-item"><i class="fa-solid fa-wallet"></i>DEPOSIT</a>
        <a href="withdraw.html" class="nav-item"><i class="fa-solid fa-money-bill-transfer"></i>WITHDRAW</a>
        <a href="reward.html" class="nav-item"><i class="fa-solid fa-gift"></i>REWARD</a>
        <a href="profil.html" class="nav-item"><i class="fa-solid fa-user"></i>PROFIL</a>
    </div>

    <script src="global.js"></script>
    <script>
        const board = document.getElementById('game-board');
        const betList = [400, 800, 1000, 2000, 5000, 10000, 20000, 50000];
        const multipliers = [5, 2, 1.2, 0.5, 0.2, 0.5, 1.2, 2, 5];
        let betIdx = 0, pegLocs = [], speed = 'normal', isAuto = false, autoInt;

        function updateSaldoUI() {
            const s = localStorage.getItem('user_saldo') || 0;
            document.getElementById('display-saldo').innerText = "IDR " + Number(s).toLocaleString();
        }

        function init() {
            board.innerHTML = ''; pegLocs = [];
            const rows = 9, centerX = board.offsetWidth / 2;
            if(centerX === 0) return setTimeout(init, 100);
            for (let r = 2; r <= rows; r++) {
                for (let i = 0; i < r; i++) {
                    const x = centerX + (i - (r - 1) / 2) * 38;
                    const y = r * 35;
                    const p = document.createElement('div');
                    p.className = 'peg'; p.style.left = x + 'px'; p.style.top = y + 'px';
                    board.appendChild(p); pegLocs.push({ x, y, el: p });
                }
            }
            const row = document.getElementById('slot-row'); row.innerHTML = '';
            multipliers.forEach(m => {
                const s = document.createElement('div');
                s.className = `slot ${m >= 2 ? 's-high' : m >= 1 ? 's-mid' : 's-low'}`;
                s.innerText = m + 'x'; row.appendChild(s);
            });
        }

        function setSpeed(m) {
            speed = m;
            document.getElementById('m-normal').classList.toggle('active', m === 'normal');
            document.getElementById('m-turbo').classList.toggle('active', m === 'turbo');
        }

        function toggleAuto() {
            isAuto = !isAuto;
            document.getElementById('m-auto').innerText = isAuto ? "AUTO: ON" : "AUTO: OFF";
            document.getElementById('m-auto').classList.toggle('active', isAuto);
            if(isAuto) autoInt = setInterval(handlePlay, speed === 'turbo' ? 400 : 1000);
            else clearInterval(autoInt);
        }

        function changeBet(d) {
            betIdx = Math.max(0, Math.min(betList.length - 1, betIdx + d));
            document.getElementById('current-bet').innerText = betList[betIdx].toLocaleString();
        }

        function handlePlay() {
            const bet = betList[betIdx];
            let saldo = Number(localStorage.getItem('user_saldo') || 0);
            if (saldo < bet) { if(isAuto) toggleAuto(); return alert("Saldo Habis!"); }
            localStorage.setItem('user_saldo', saldo - bet);
            updateSaldoUI();
            dropBall(bet);
        }

        function dropBall(bet) {
            const ball = document.createElement('div');
            ball.className = 'ball';
            board.appendChild(ball);
            let px = board.offsetWidth / 2 + (Math.random() * 4 - 2), py = 10, vx = (Math.random() - 0.5) * 2, vy = 0;
            const anim = setInterval(() => {
                vy += 0.6; px += vx; py += vy;
                pegLocs.forEach(p => {
                    const dx = px - p.x, dy = py - p.y, dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < 11) {
                        vx = (dx / dist) * 2.8; vy = (dy / dist) * 1.5;
                        p.el.classList.add('hit'); setTimeout(() => p.el.classList.remove('hit'), 80);
                    }
                });
                if (px < 15 || px > board.offsetWidth - 15) vx *= -0.6;
                ball.style.left = px + 'px'; ball.style.top = py + 'px';
                if (py > 370) {
                    clearInterval(anim); ball.remove();
                    finish(px, bet);
                }
            }, 16);
        }

        function finish(x, bet) {
            const idx = Math.floor(x / (board.offsetWidth / multipliers.length));
            const mult = multipliers[Math.max(0, Math.min(multipliers.length - 1, idx))];
            const win = Math.floor(bet * mult);
            const slots = document.querySelectorAll('.slot');
            const s = slots[Math.max(0, Math.min(slots.length - 1, idx))];
            s.classList.add('active'); setTimeout(() => s.classList.remove('active'), 400);
            
            const fs = document.getElementById('floating-score');
            document.getElementById('score-val').innerText = "IDR " + win.toLocaleString();
            fs.style.display = 'block'; setTimeout(() => fs.style.display = 'none', 2000);

            let cur = Number(localStorage.getItem('user_saldo') || 0);
            localStorage.setItem('user_saldo', cur + win);
            updateSaldoUI();
            
            // Sync ke Sheet Anda via global.js
            if(typeof syncResult === 'function') syncResult(bet, mult, win);
        }

        window.onload = () => { init(); updateSaldoUI(); };
    </script>
</body>
</html>
