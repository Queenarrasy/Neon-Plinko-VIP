<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON PLINKO VIP - REFINED</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            /* Warna diredupkan (bias-bias saja) */
            --pink: #ff0077; --blue: #0044ff; --yellow: #fbff00; --white: #ffffff; --bg: #03040a;
            --neon-pink: 0 0 8px rgba(255, 0, 119, 0.5);
            --neon-blue: 0 0 8px rgba(0, 68, 255, 0.5);
            --neon-white: 0 0 5px rgba(255, 255, 255, 0.3);
            --neon-yellow: 0 0 8px rgba(251, 255, 0, 0.5);
        }
        body {
            background: var(--bg); color: white; font-family: sans-serif;
            margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column;
        }

        /* CUSTOM NEON MODAL (Replacement for Alert) */
        #neon-modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #0a0b1e; border: 2px solid var(--pink); border-radius: 15px;
            box-shadow: var(--neon-pink); z-index: 9999; padding: 20px; text-align: center;
            min-width: 250px; animation: modalIn 0.3s ease;
        }
        @keyframes modalIn { from { opacity: 0; scale: 0.8; } to { opacity: 1; scale: 1; } }
        .modal-btn {
            margin-top: 15px; padding: 8px 20px; border-radius: 5px; cursor: pointer;
            border: 1px solid var(--yellow); background: transparent; color: var(--yellow); font-weight: bold;
        }

        /* HEADER */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; background: rgba(0, 0, 0, 0.9); border-bottom: 2px solid var(--blue);
        }
        .header-item { text-align: center; cursor: pointer; min-width: 60px; }
        .header-item i { font-size: 30px; display: block; margin-bottom: 2px; }
        .header-item span { font-size: 10px; font-weight: 900; letter-spacing: 1px; }

        .balance-box {
            background: #000; border: 2px solid var(--pink); border-radius: 20px;
            padding: 5px 20px; box-shadow: var(--neon-pink); text-align: center;
        }
        .saldo-label { font-size: 9px; color: var(--white); text-shadow: var(--neon-white); font-weight: bold; }
        #display-saldo { font-size: 18px; font-weight: bold; color: var(--white); }

        /* BOARD */
        #game-board { position: relative; width: 100%; height: 360px; overflow: visible; }
        .peg {
            position: absolute; width: 6px; height: 6px; background: var(--white);
            border-radius: 50%; box-shadow: var(--neon-white); transform: translate(-50%, -50%);
        }
        .peg.hit { background: var(--yellow); box-shadow: var(--neon-yellow); transform: translate(-50%, -50%) scale(1.5); }
        .ball {
            position: absolute; width: 14px; height: 14px; background: var(--pink);
            border-radius: 50%; box-shadow: var(--neon-pink); transform: translate(-50%, -50%); z-index: 10;
        }
        
        /* MULTIPLIERS */
        .multiplier-row { display: flex; justify-content: center; gap: 4px; padding: 0 10px; margin: 10px 0; }
        .slot {
            flex: 1; height: 35px; display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: 900; border-radius: 5px; color: #000; transition: 0.2s;
        }
        .slot.active { transform: translateY(-10px) scale(1.1); box-shadow: 0 0 15px white; filter: brightness(1.3); }
        .s-high { background: var(--pink); } .s-mid { background: var(--yellow); } .s-low { background: var(--blue); color: white !important; }

        #floating-score {
            position: fixed; top: 100px; right: 10px; background: rgba(0,0,0,0.85);
            border: 1px solid var(--yellow); border-radius: 8px; padding: 8px;
            z-index: 1000; box-shadow: var(--neon-yellow); min-width: 100px;
        }
        .score-entry { font-size: 11px; font-weight: bold; color: var(--yellow); border-bottom: 1px solid rgba(251, 255, 0, 0.1); padding: 2px 0; }

        /* CONTROLS */
        .controls { padding: 15px; background: #050714; border-top: 2px solid var(--blue); }
        .mode-row { display: flex; justify-content: center; gap: 8px; margin-bottom: 12px; }
        .btn-mode { background: transparent; padding: 10px 15px; border-radius: 10px; font-size: 10px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        
        #m-normal { border: 1px solid var(--pink); color: var(--pink); }
        #m-normal.active { background: var(--pink); color: white; box-shadow: var(--neon-pink); }
        #m-turbo { border: 1px solid var(--blue); color: var(--blue); }
        #m-turbo.active { background: var(--yellow); border-color: var(--yellow); color: black; box-shadow: var(--neon-yellow); }
        #m-auto { border: 1px solid var(--yellow); color: var(--yellow); }
        #m-auto.active { background: var(--blue); border-color: var(--blue); color: white; box-shadow: var(--neon-blue); }

        .btn-play {
            width: 100%; padding: 16px; border-radius: 50px; background: linear-gradient(90deg, #aa0055, #0022aa);
            color: white; font-weight: 900; border: 2px solid var(--yellow); text-transform: uppercase;
        }
        
        .nav-bottom { display: grid; grid-template-columns: repeat(3, 1fr); background: #000; padding: 12px 5px; gap: 10px; border-top: 2px solid var(--blue); }
        .nav-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 8px 0; border-radius: 12px; text-decoration: none; border: 1px solid; font-weight: 900; }
        .nav-btn i { font-size: 20px; margin-bottom: 4px; }
        .nav-btn span { font-size: 10px; }

        .btn-withdraw { border-color: var(--yellow); }
        .btn-withdraw i { color: var(--pink); }
        .btn-withdraw span { color: var(--blue); }
        .btn-deposit { border-color: var(--pink); }
        .btn-deposit i { color: var(--blue); }
        .btn-deposit span { color: var(--yellow); }
        .btn-reward { border-color: var(--blue); }
        .btn-reward i { color: var(--yellow); }
        .btn-reward span { color: var(--pink); }
    </style>
</head>
<body>

    <audio id="snd-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
    <audio id="snd-hit" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
    <audio id="snd-win" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
    <audio id="snd-error" src="https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3"></audio>

    <div id="neon-modal">
        <h3 id="modal-title" style="color: var(--pink); margin: 0;">NOTIFIKASI</h3>
        <p id="modal-msg" style="color: white; font-size: 14px;"></p>
        <button class="modal-btn" onclick="closeModal()">OK</button>
    </div>

    <div id="floating-score">
        <div id="score-list">
            <div class="score-entry" style="opacity:0.3">Waiting...</div>
            <div class="score-entry" style="opacity:0.3">Waiting...</div>
            <div class="score-entry" style="opacity:0.3">Waiting...</div>
        </div>
    </div>

    <div class="header">
        <div class="header-item" onclick="playSound('click'); location.href='profil.html'">
            <i class="fa-solid fa-circle-user" style="color: var(--yellow); text-shadow: var(--neon-yellow);"></i>
            <span style="color: var(--yellow);">PROFIL</span>
        </div>
        <div class="balance-box">
            <div class="saldo-label">SALDO UTAMA</div>
            <div id="display-saldo">IDR 0</div>
        </div>
        <div class="header-item" onclick="playSound('click'); location.href='settings.html'">
            <i class="fa-solid fa-gear" style="color: var(--blue); text-shadow: var(--neon-blue);"></i>
            <span style="color: var(--blue);">SETTING</span>
        </div>
    </div>

    <div id="game-board"></div>
    <div class="multiplier-row" id="slot-row"></div>

    <div class="controls">
        <div class="mode-row">
            <button class="btn-mode active" id="m-normal" onclick="setSpeed('normal')">NORMAL</button>
            <button class="btn-mode" id="m-turbo" onclick="setSpeed('turbo')">TURBO</button>
            <button class="btn-mode" id="m-auto" onclick="toggleAuto()">AUTO: OFF</button>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; padding: 0 10px;">
            <i class="fa-solid fa-circle-minus" onclick="changeBet(-1)" style="color:var(--pink); font-size: 25px;"></i>
            <div style="text-align: center;">
                <div style="font-size: 9px; color: gray; font-weight: bold;">TARUHAN</div>
                <span id="current-bet" style="color:var(--yellow); font-size:22px; font-weight:bold;">400</span>
            </div>
            <i class="fa-solid fa-circle-plus" onclick="changeBet(1)" style="color:var(--blue); font-size: 25px;"></i>
        </div>
        <button class="btn-play" onclick="handlePlay()">PLAY BALL</button>
    </div>

    <div class="nav-bottom">
        <a href="withdraw.html" class="nav-btn btn-withdraw" onclick="playSound('click')">
            <i class="fa-solid fa-money-bill-transfer"></i><span>WITHDRAW</span>
        </a>
        <a href="deposit.html" class="nav-btn btn-deposit" onclick="playSound('click')">
            <i class="fa-solid fa-wallet"></i><span>DEPOSIT</span>
        </a>
        <a href="reward.html" class="nav-btn btn-reward" onclick="playSound('click')">
            <i class="fa-solid fa-gift"></i><span>REWARD</span>
        </a>
    </div>

    <script src="global.js"></script>
    <script>
        const board = document.getElementById('game-board');
        // Update Daftar Taruhan sesuai instruksi
        const betList = [400, 800, 1000, 1200, 1600, 1800, 2000, 4000, 8000, 10000, 12000, 16000, 18000, 20000];
        const multipliers = [5, 2, 1.2, 0.5, 0.2, 0.5, 1.2, 2, 5];
        let betIdx = 0, pegLocs = [], speed = 'normal', isAuto = false, autoInt;
        let recentWins = [];

        function playSound(type) {
            const s = document.getElementById('snd-' + type);
            if(s) { s.currentTime = 0; s.play().catch(e => {}); }
        }

        function showModal(msg, color = 'var(--pink)') {
            document.getElementById('modal-msg').innerText = msg;
            document.getElementById('neon-modal').style.borderColor = color;
            document.getElementById('modal-title').style.color = color;
            document.getElementById('neon-modal').style.display = 'block';
        }

        function closeModal() {
            playSound('click');
            document.getElementById('neon-modal').style.display = 'none';
        }

        function updateSaldoUI() {
            // Memastikan saldo sinkron dengan localStorage
            const s = localStorage.getItem('user_saldo') || 0;
            document.getElementById('display-saldo').innerText = "IDR " + Number(s).toLocaleString();
        }

        function init() {
            board.innerHTML = ''; pegLocs = [];
            const rows = 9, centerX = board.offsetWidth / 2;
            if(centerX === 0) return setTimeout(init, 100);
            for (let r = 2; r <= rows; r++) {
                for (let i = 0; i < r; i++) {
                    const x = centerX + (i - (r - 1) / 2) * 38;
                    const y = r * 35;
                    const p = document.createElement('div');
                    p.className = 'peg'; p.style.left = x + 'px'; p.style.top = y + 'px';
                    board.appendChild(p); pegLocs.push({ x, y, el: p });
                }
            }
            const row = document.getElementById('slot-row'); row.innerHTML = '';
            multipliers.forEach(m => {
                const s = document.createElement('div');
                s.className = `slot ${m >= 2 ? 's-high' : m >= 1 ? 's-mid' : 's-low'}`;
                s.innerText = m + 'x'; row.appendChild(s);
            });
        }

        function setSpeed(m) {
            playSound('click');
            speed = m;
            document.getElementById('m-normal').classList.toggle('active', m === 'normal');
            document.getElementById('m-turbo').classList.toggle('active', m === 'turbo');
            if(isAuto) { clearInterval(autoInt); autoInt = setInterval(handlePlay, speed === 'turbo' ? 400 : 1000); }
        }

        function toggleAuto() {
            playSound('click');
            isAuto = !isAuto;
            document.getElementById('m-auto').innerText = isAuto ? "AUTO: ON" : "AUTO: OFF";
            document.getElementById('m-auto').classList.toggle('active', isAuto);
            if(isAuto) autoInt = setInterval(handlePlay, speed === 'turbo' ? 400 : 1000);
            else clearInterval(autoInt);
        }

        function changeBet(d) {
            playSound('click');
            betIdx = Math.max(0, Math.min(betList.length - 1, betIdx + d));
            document.getElementById('current-bet').innerText = betList[betIdx].toLocaleString();
        }

        function handlePlay() {
            const bet = betList[betIdx];
            let saldo = Number(localStorage.getItem('user_saldo') || 0);
            if (saldo < bet) { 
                playSound('error');
                if(isAuto) toggleAuto(); 
                return showModal("Saldo Tidak Cukup!", 'var(--pink)'); 
            }
            localStorage.setItem('user_saldo', saldo - bet);
            updateSaldoUI();
            dropBall(bet);
        }

        function dropBall(bet) {
            const ball = document.createElement('div');
            ball.className = 'ball';
            board.appendChild(ball);
            let px = board.offsetWidth / 2 + (Math.random() * 4 - 2), py = 10, vx = (Math.random() - 0.5) * 2, vy = 0;
            const anim = setInterval(() => {
                vy += 0.6; px += vx; py += vy;
                pegLocs.forEach(p => {
                    const dx = px - p.x, dy = py - p.y, dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < 11) {
                        playSound('hit');
                        vx = (dx / dist) * 2.8; vy = (dy / dist) * 1.5;
                        p.el.classList.add('hit'); setTimeout(() => p.el.classList.remove('hit'), 80);
                    }
                });
                if (px < 15 || px > board.offsetWidth - 15) vx *= -0.6;
                ball.style.left = px + 'px'; ball.style.top = py + 'px';
                if (py > 370) {
                    clearInterval(anim); ball.remove();
                    finish(px, bet);
                }
            }, 16);
        }

        function updateScoreList(winAmount) {
            const list = document.getElementById('score-list');
            recentWins.unshift("IDR " + winAmount.toLocaleString());
            if(recentWins.length > 3) recentWins.pop();
            list.innerHTML = '';
            recentWins.forEach(win => {
                const div = document.createElement('div');
                div.className = 'score-entry';
                div.innerText = win;
                list.appendChild(div);
            });
        }

        function finish(x, bet) {
            const idx = Math.floor(x / (board.offsetWidth / multipliers.length));
            const mult = multipliers[Math.max(0, Math.min(multipliers.length - 1, idx))];
            const win = Math.floor(bet * mult);
            
            if(mult >= 1) playSound('win');
            
            const slots = document.querySelectorAll('.slot');
            const s = slots[Math.max(0, Math.min(slots.length - 1, idx))];
            s.classList.add('active'); setTimeout(() => s.classList.remove('active'), 400);
            
            updateScoreList(win);
            let cur = Number(localStorage.getItem('user_saldo') || 0);
            localStorage.setItem('user_saldo', cur + win);
            updateSaldoUI();
            
            if(typeof syncResult === 'function') syncResult(bet, mult, win);
        }

        window.onload = () => { init(); updateSaldoUI(); };
    </script>
</body>
</html>
